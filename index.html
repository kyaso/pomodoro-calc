<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Calculator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 50px;
        }

        label {
            display: block;
            margin-bottom: 10px;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .result {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Pomodoro Calculator</h1>

    <label for="pomodoroLength">Pomodoro Length (minutes)</label>
    <input type="number" id="pomodoroLength" value="25" onkeydown="checkEnter(event)">

    <label for="shortBreakLength">Short Break Length (minutes)</label>
    <input type="number" id="shortBreakLength" value="5" onkeydown="checkEnter(event)">

    <label for="longBreakLength">Long Break Length (minutes)</label>
    <input type="number" id="longBreakLength" value="15" onkeydown="checkEnter(event)">

    <label for="longBreakInterval">Long Break Interval (#pomodoros)</label>
    <input type="number" id="longBreakInterval" value="4" onkeydown="checkEnter(event)">

    <label for="startTime">Start Time</label>
    <input type="time" id="startTime" value="" onkeydown="checkEnter(event)">

    <label for="endTime">End Time</label>
    <input type="time" id="endTime" value="" onkeydown="checkEnter(event)">

    <button onclick="calculatePomodoros()">Calculate Pomodoros</button>

    <p class="result" id="resultTotalPomos"></p>
    <p class="result" id="resultLongBreaks"></p>
    <p class="result" id="resultTotalWorkTime"></p>

    <script>
        class Result {
            constructor(pomodoroCount, longBreaks, totalWorkTimeHours, totalWorkTimeMins) {
                this.pomodoroCount = pomodoroCount
                this.longBreaks = longBreaks
                this.totalWorkTimeHours = totalWorkTimeHours
                this.totalWorkTimeMins = totalWorkTimeMins
            }
        }

        class PomoConfig {
            constructor(pomodoroLength, shortBreakLength, longBreakLength, longBreakInterval, startTime, endTime) {
                this.pomodoroLength = pomodoroLength
                this.shortBreakLength = shortBreakLength
                this.longBreakLength = longBreakLength
                this.longBreakInterval = longBreakInterval
                this.startTime = startTime
                this.endTime = endTime
                this.pomosPerSuperBlock = longBreakInterval
            }

            validateInputs() {
                if (isNaN(this.pomodoroLength) || isNaN(this.shortBreakLength) || isNaN(this.longBreakLength) || isNaN(this.longBreakInterval)) {
                    alert("Please enter valid numbers for Pomodoro and break lengths.")
                    return false
                }
                if (startTime === "" || endTime === "") {
                    alert("Please enter start and end times.")
                    return false
                }
                return true
            }

            init() {
                this.initPomo()
                this.initTotalTime()
            }

            initTotalTime() {
                const start = new Date(`2023-01-01 ${this.startTime}`)
                const end = new Date(`2023-01-01 ${this.endTime}`)
                this.totalTime = (end - start) / (1000 * 60) // in minutes
            }

            initPomo() {
                this.pomodoroCount = 0
                this.pomoPlusBreak = this.pomodoroLength + this.shortBreakLength
                this.superBlock = this.pomosPerSuperBlock * this.pomoPlusBreak + (this.longBreakLength-this.shortBreakLength)
            }

            calcPomosWithSuperBlocks() {
                if (this.longBreakInterval == 0) {
                    return
                }

                while (this.totalTime >= this.superBlock) {
                    this.pomodoroCount += this.pomosPerSuperBlock
                    this.totalTime -= this.superBlock
                }
            }

            calcPomosWithoutSuperBlocks() {
                while (this.totalTime >= this.pomoPlusBreak) {
                    this.pomodoroCount++
                    this.totalTime -= this.pomoPlusBreak
                }
                if (this.totalTime == this.pomodoroLength) {
                    this.pomodoroCount++
                }
            }

            calcLongBreaks() {
                this.longBreaks = 0
                if (this.longBreakLength > 0 && this.longBreakInterval != 0) {
                    this.longBreaks = Math.floor(this.pomodoroCount / this.longBreakInterval)
                    // Ignore last long break
                    if (this.pomodoroCount % this.longBreakInterval == 0) {
                        this.longBreaks--
                    }
                }
            }

            calcResult() {
                this.totalWorkTime = this.pomodoroLength * this.pomodoroCount
                this.totalWorkTimeHours = Math.floor(this.totalWorkTime / 60)
                this.totalWorkTimeMins = this.totalWorkTime - (60 * this.totalWorkTimeHours)
            }

            calcPomos() {
                this.init()
                this.calcPomosWithSuperBlocks()
                this.calcPomosWithoutSuperBlocks()
                this.calcLongBreaks()
                this.calcResult()

                const res = new Result(
                    this.pomodoroCount,
                    this.longBreaks,
                    this.totalWorkTimeHours,
                    this.totalWorkTimeMins
                )
                return res
            }
        }

        function checkEnter(event) {
            if (event.key === 'Enter') {
                calculatePomodoros();
            }
        }

        function printResult(result) {
            const resultTotalPomos = `Total Pomodoros: ${result.pomodoroCount}`
            const resultLongBreaks = `Long Breaks: ${result.longBreaks}`
            const resultTotalWorkTime = `Total work time: ${result.totalWorkTimeHours}h${result.totalWorkTimeMins}m`
            document.getElementById("resultTotalPomos").textContent = resultTotalPomos
            document.getElementById("resultLongBreaks").textContent = resultLongBreaks
            document.getElementById("resultTotalWorkTime").textContent = resultTotalWorkTime
        }

        function calculatePomodoros() {
            const pomodoroLength = parseInt(document.getElementById("pomodoroLength").value);
            const shortBreakLength = parseInt(document.getElementById("shortBreakLength").value);
            const longBreakLength = parseInt(document.getElementById("longBreakLength").value);
            const longBreakInterval = parseInt(document.getElementById("longBreakInterval").value);
            const startTime = document.getElementById("startTime").value;
            const endTime = document.getElementById("endTime").value;

            const config = new PomoConfig(
                pomodoroLength,
                shortBreakLength,
                longBreakLength,
                longBreakInterval,
                startTime,
                endTime
            )
            if (!config.validateInputs()) {
                return
            }

            result = config.calcPomos()
            printResult(result)
        }
    </script>
</body>
</html>
